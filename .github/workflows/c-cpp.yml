name: C/C++ CI (Windows)

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  release-build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - uses: abel0b/setup-premake@v2.4
      with:
        version: "5.0.0-beta2"
        
    - name: Add msbuild to PATH
      uses: microsoft/setup-msbuild@v2

    - name: Generate Visual Studio Project with Premake
      run: premake5 --file=Build.lua vs2022

    - name: Build app for release
      run: msbuild RED.sln -t:rebuild -verbosity:diag -property:Configuration=Release -property:Platform=x64

    - name: Run Tests
      run: |
        cd bin\Release
        MyTests.exe

    - name: Verify Distribution Build
      run: |
        cd bin\Release
        MyExecutable.exe --distcheck
   
  debug-build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - uses: abel0b/setup-premake@v2.4
      with:
        version: "5.0.0-beta2"
        
    - name: Add msbuild to PATH
      uses: microsoft/setup-msbuild@v2

    - name: Generate Visual Studio Project with Premake
      run: premake5 --file=Build.lua vs2022

    - name: Build app for release
      run: msbuild RED.sln -t:rebuild -verbosity:diagnostic -property:Configuration=Debug -property:Platform=x64

    - name: Run Tests
      run: |
        cd bin\Release
        MyTests.exe

    - name: Verify Distribution Build
      run: |
        cd bin\Release
        MyExecutable.exe --distcheck
